"use strict";const A=require("electron"),L=require("path"),x=require("fs"),J=require("fs/promises"),xe=require("crypto"),W=require("child_process"),fe=require("https"),ne=require("http"),Qe=require("os"),et=require("zlib");function lt(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var X={exports:{}},ue,Pe;function tt(){return Pe||(Pe=1,ue={LOCHDR:30,LOCSIG:67324752,LOCVER:4,LOCFLG:6,LOCHOW:8,LOCTIM:10,LOCCRC:14,LOCSIZ:18,LOCLEN:22,LOCNAM:26,LOCEXT:28,EXTSIG:134695760,EXTHDR:16,EXTCRC:4,EXTSIZ:8,EXTLEN:12,CENHDR:46,CENSIG:33639248,CENVEM:4,CENVER:6,CENFLG:8,CENHOW:10,CENTIM:12,CENCRC:16,CENSIZ:20,CENLEN:24,CENNAM:28,CENEXT:30,CENCOM:32,CENDSK:34,CENATT:36,CENATX:38,CENOFF:42,ENDHDR:22,ENDSIG:101010256,ENDSUB:8,ENDTOT:10,ENDSIZ:12,ENDOFF:16,ENDCOM:20,END64HDR:20,END64SIG:117853008,END64START:4,END64OFF:8,END64NUMDISKS:16,ZIP64SIG:101075792,ZIP64HDR:56,ZIP64LEAD:12,ZIP64SIZE:4,ZIP64VEM:12,ZIP64VER:14,ZIP64DSK:16,ZIP64DSKDIR:20,ZIP64SUB:24,ZIP64TOT:32,ZIP64SIZB:40,ZIP64OFF:48,ZIP64EXTRA:56,STORED:0,SHRUNK:1,REDUCED1:2,REDUCED2:3,REDUCED3:4,REDUCED4:5,IMPLODED:6,DEFLATED:8,ENHANCED_DEFLATED:9,PKWARE:10,BZIP2:12,LZMA:14,IBM_TERSE:18,IBM_LZ77:19,AES_ENCRYPT:99,FLG_ENC:1,FLG_COMP1:2,FLG_COMP2:4,FLG_DESC:8,FLG_ENH:16,FLG_PATCH:32,FLG_STR:64,FLG_EFS:2048,FLG_MSK:4096,FILE:2,BUFFER:1,NONE:0,EF_ID:0,EF_SIZE:2,ID_ZIP64:1,ID_AVINFO:7,ID_PFS:8,ID_OS2:9,ID_NTFS:10,ID_OPENVMS:12,ID_UNIX:13,ID_FORK:14,ID_PATCH:15,ID_X509_PKCS7:20,ID_X509_CERTID_F:21,ID_X509_CERTID_C:22,ID_STRONGENC:23,ID_RECORD_MGT:24,ID_X509_PKCS7_RL:25,ID_IBM1:101,ID_IBM2:102,ID_POSZIP:18064,EF_ZIP64_OR_32:4294967295,EF_ZIP64_OR_16:65535,EF_ZIP64_SUNCOMP:0,EF_ZIP64_SCOMP:8,EF_ZIP64_RHO:16,EF_ZIP64_DSN:24}),ue}var de={},je;function Fe(){return je||(je=1,(function(n){const e={INVALID_LOC:"Invalid LOC header (bad signature)",INVALID_CEN:"Invalid CEN header (bad signature)",INVALID_END:"Invalid END header (bad signature)",DESCRIPTOR_NOT_EXIST:"No descriptor present",DESCRIPTOR_UNKNOWN:"Unknown descriptor format",DESCRIPTOR_FAULTY:"Descriptor data is malformed",NO_DATA:"Nothing to decompress",BAD_CRC:"CRC32 checksum failed {0}",FILE_IN_THE_WAY:"There is a file in the way: {0}",UNKNOWN_METHOD:"Invalid/unsupported compression method",AVAIL_DATA:"inflate::Available inflate data did not terminate",INVALID_DISTANCE:"inflate::Invalid literal/length or distance code in fixed or dynamic block",TO_MANY_CODES:"inflate::Dynamic block code description: too many length or distance codes",INVALID_REPEAT_LEN:"inflate::Dynamic block code description: repeat more than specified lengths",INVALID_REPEAT_FIRST:"inflate::Dynamic block code description: repeat lengths with no first length",INCOMPLETE_CODES:"inflate::Dynamic block code description: code lengths codes incomplete",INVALID_DYN_DISTANCE:"inflate::Dynamic block code description: invalid distance code lengths",INVALID_CODES_LEN:"inflate::Dynamic block code description: invalid literal/length code lengths",INVALID_STORE_BLOCK:"inflate::Stored block length did not match one's complement",INVALID_BLOCK_TYPE:"inflate::Invalid block type (type == 3)",CANT_EXTRACT_FILE:"Could not extract the file",CANT_OVERRIDE:"Target file already exists",DISK_ENTRY_TOO_LARGE:"Number of disk entries is too large",NO_ZIP:"No zip file was loaded",NO_ENTRY:"Entry doesn't exist",DIRECTORY_CONTENT_ERROR:"A directory cannot have content",FILE_NOT_FOUND:'File not found: "{0}"',NOT_IMPLEMENTED:"Not implemented",INVALID_FILENAME:"Invalid filename",INVALID_FORMAT:"Invalid or unsupported zip format. No END header found",INVALID_PASS_PARAM:"Incompatible password parameter",WRONG_PASSWORD:"Wrong Password",COMMENT_TOO_LONG:"Comment is too long",EXTRA_FIELD_PARSE_ERROR:"Extra field parsing error"};function r(a){return function(...l){return l.length&&(a=a.replace(/\{(\d)\}/g,(u,o)=>l[o]||"")),new Error("ADM-ZIP: "+a)}}for(const a of Object.keys(e))n[a]=r(e[a])})(de)),de}var he,be;function ft(){if(be)return he;be=1;const n=x,e=L,r=tt(),a=Fe(),l=typeof process=="object"&&process.platform==="win32",u=t=>typeof t=="object"&&t!==null,o=new Uint32Array(256).map((t,i)=>{for(let g=0;g<8;g++)(i&1)!==0?i=3988292384^i>>>1:i>>>=1;return i>>>0});function s(t){this.sep=e.sep,this.fs=n,u(t)&&u(t.fs)&&typeof t.fs.statSync=="function"&&(this.fs=t.fs)}return he=s,s.prototype.makeDir=function(t){const i=this;function g(E){let v=E.split(i.sep)[0];E.split(i.sep).forEach(function(m){if(!(!m||m.substr(-1,1)===":")){v+=i.sep+m;var I;try{I=i.fs.statSync(v)}catch{i.fs.mkdirSync(v)}if(I&&I.isFile())throw a.FILE_IN_THE_WAY(`"${v}"`)}})}g(t)},s.prototype.writeFileTo=function(t,i,g,E){const v=this;if(v.fs.existsSync(t)){if(!g)return!1;var m=v.fs.statSync(t);if(m.isDirectory())return!1}var I=e.dirname(t);v.fs.existsSync(I)||v.makeDir(I);var D;try{D=v.fs.openSync(t,"w",438)}catch{v.fs.chmodSync(t,438),D=v.fs.openSync(t,"w",438)}if(D)try{v.fs.writeSync(D,i,0,i.length,0)}finally{v.fs.closeSync(D)}return v.fs.chmodSync(t,E||438),!0},s.prototype.writeFileToAsync=function(t,i,g,E,v){typeof E=="function"&&(v=E,E=void 0);const m=this;m.fs.exists(t,function(I){if(I&&!g)return v(!1);m.fs.stat(t,function(D,F){if(I&&F.isDirectory())return v(!1);var _=e.dirname(t);m.fs.exists(_,function(w){w||m.makeDir(_),m.fs.open(t,"w",438,function(S,d){S?m.fs.chmod(t,438,function(){m.fs.open(t,"w",438,function(c,p){m.fs.write(p,i,0,i.length,0,function(){m.fs.close(p,function(){m.fs.chmod(t,E||438,function(){v(!0)})})})})}):d?m.fs.write(d,i,0,i.length,0,function(){m.fs.close(d,function(){m.fs.chmod(t,E||438,function(){v(!0)})})}):m.fs.chmod(t,E||438,function(){v(!0)})})})})})},s.prototype.findFiles=function(t){const i=this;function g(E,v,m){let I=[];return i.fs.readdirSync(E).forEach(function(D){const F=e.join(E,D),_=i.fs.statSync(F);I.push(e.normalize(F)+(_.isDirectory()?i.sep:"")),_.isDirectory()&&m&&(I=I.concat(g(F,v,m)))}),I}return g(t,void 0,!0)},s.prototype.findFilesAsync=function(t,i){const g=this;let E=[];g.fs.readdir(t,function(v,m){if(v)return i(v);let I=m.length;if(!I)return i(null,E);m.forEach(function(D){D=e.join(t,D),g.fs.stat(D,function(F,_){if(F)return i(F);_&&(E.push(e.normalize(D)+(_.isDirectory()?g.sep:"")),_.isDirectory()?g.findFilesAsync(D,function(w,S){if(w)return i(w);E=E.concat(S),--I||i(null,E)}):--I||i(null,E))})})})},s.prototype.getAttributes=function(){},s.prototype.setAttributes=function(){},s.crc32update=function(t,i){return o[(t^i)&255]^t>>>8},s.crc32=function(t){typeof t=="string"&&(t=Buffer.from(t,"utf8"));let i=t.length,g=-1;for(let E=0;E<i;)g=s.crc32update(g,t[E++]);return~g>>>0},s.methodToString=function(t){switch(t){case r.STORED:return"STORED ("+t+")";case r.DEFLATED:return"DEFLATED ("+t+")";default:return"UNSUPPORTED ("+t+")"}},s.canonical=function(t){if(!t)return"";const i=e.posix.normalize("/"+t.split("\\").join("/"));return e.join(".",i)},s.zipnamefix=function(t){if(!t)return"";const i=e.posix.normalize("/"+t.split("\\").join("/"));return e.posix.join(".",i)},s.findLast=function(t,i){if(!Array.isArray(t))throw new TypeError("arr is not array");const g=t.length>>>0;for(let E=g-1;E>=0;E--)if(i(t[E],E,t))return t[E]},s.sanitize=function(t,i){t=e.resolve(e.normalize(t));for(var g=i.split("/"),E=0,v=g.length;E<v;E++){var m=e.normalize(e.join(t,g.slice(E,v).join(e.sep)));if(m.indexOf(t)===0)return m}return e.normalize(e.join(t,e.basename(i)))},s.toBuffer=function(i,g){return Buffer.isBuffer(i)?i:i instanceof Uint8Array?Buffer.from(i):typeof i=="string"?g(i):Buffer.alloc(0)},s.readBigUInt64LE=function(t,i){var g=Buffer.from(t.slice(i,i+8));return g.swap64(),parseInt(`0x${g.toString("hex")}`)},s.fromDOS2Date=function(t){return new Date((t>>25&127)+1980,Math.max((t>>21&15)-1,0),Math.max(t>>16&31,1),t>>11&31,t>>5&63,(t&31)<<1)},s.fromDate2DOS=function(t){let i=0,g=0;return t.getFullYear()>1979&&(i=(t.getFullYear()-1980&127)<<9|t.getMonth()+1<<5|t.getDate(),g=t.getHours()<<11|t.getMinutes()<<5|t.getSeconds()>>1),i<<16|g},s.isWin=l,s.crcTable=o,he}var pe,$e;function ut(){if($e)return pe;$e=1;const n=L;return pe=function(e,{fs:r}){var a=e||"",l=o(),u=null;function o(){return{directory:!1,readonly:!1,hidden:!1,executable:!1,mtime:0,atime:0}}return a&&r.existsSync(a)?(u=r.statSync(a),l.directory=u.isDirectory(),l.mtime=u.mtime,l.atime=u.atime,l.executable=(73&u.mode)!==0,l.readonly=(128&u.mode)===0,l.hidden=n.basename(a)[0]==="."):console.warn("Invalid path: "+a),{get directory(){return l.directory},get readOnly(){return l.readonly},get hidden(){return l.hidden},get mtime(){return l.mtime},get atime(){return l.atime},get executable(){return l.executable},decodeAttributes:function(){},encodeAttributes:function(){},toJSON:function(){return{path:a,isDirectory:l.directory,isReadOnly:l.readonly,isHidden:l.hidden,isExecutable:l.executable,mTime:l.mtime,aTime:l.atime}},toString:function(){return JSON.stringify(this.toJSON(),null,"	")}}},pe}var me,Me;function dt(){return Me||(Me=1,me={efs:!0,encode:n=>Buffer.from(n,"utf8"),decode:n=>n.toString("utf8")}),me}var He;function oe(){return He||(He=1,X.exports=ft(),X.exports.Constants=tt(),X.exports.Errors=Fe(),X.exports.FileAttr=ut(),X.exports.decoder=dt()),X.exports}var ae={},ge,Be;function ht(){if(Be)return ge;Be=1;var n=oe(),e=n.Constants;return ge=function(){var r=20,a=10,l=0,u=0,o=0,s=0,t=0,i=0,g=0,E=0,v=0,m=0,I=0,D=0,F=0;r|=n.isWin?2560:768,l|=e.FLG_EFS;const _={extraLen:0},w=d=>Math.max(0,d)>>>0,S=d=>Math.max(0,d)&255;return o=n.fromDate2DOS(new Date),{get made(){return r},set made(d){r=d},get version(){return a},set version(d){a=d},get flags(){return l},set flags(d){l=d},get flags_efs(){return(l&e.FLG_EFS)>0},set flags_efs(d){d?l|=e.FLG_EFS:l&=~e.FLG_EFS},get flags_desc(){return(l&e.FLG_DESC)>0},set flags_desc(d){d?l|=e.FLG_DESC:l&=~e.FLG_DESC},get method(){return u},set method(d){switch(d){case e.STORED:this.version=10;case e.DEFLATED:default:this.version=20}u=d},get time(){return n.fromDOS2Date(this.timeval)},set time(d){this.timeval=n.fromDate2DOS(d)},get timeval(){return o},set timeval(d){o=w(d)},get timeHighByte(){return S(o>>>8)},get crc(){return s},set crc(d){s=w(d)},get compressedSize(){return t},set compressedSize(d){t=w(d)},get size(){return i},set size(d){i=w(d)},get fileNameLength(){return g},set fileNameLength(d){g=d},get extraLength(){return E},set extraLength(d){E=d},get extraLocalLength(){return _.extraLen},set extraLocalLength(d){_.extraLen=d},get commentLength(){return v},set commentLength(d){v=d},get diskNumStart(){return m},set diskNumStart(d){m=w(d)},get inAttr(){return I},set inAttr(d){I=w(d)},get attr(){return D},set attr(d){D=w(d)},get fileAttr(){return(D||0)>>16&4095},get offset(){return F},set offset(d){F=w(d)},get encrypted(){return(l&e.FLG_ENC)===e.FLG_ENC},get centralHeaderSize(){return e.CENHDR+g+E+v},get realDataOffset(){return F+e.LOCHDR+_.fnameLen+_.extraLen},get localHeader(){return _},loadLocalHeaderFromBinary:function(d){var c=d.slice(F,F+e.LOCHDR);if(c.readUInt32LE(0)!==e.LOCSIG)throw n.Errors.INVALID_LOC();_.version=c.readUInt16LE(e.LOCVER),_.flags=c.readUInt16LE(e.LOCFLG),_.method=c.readUInt16LE(e.LOCHOW),_.time=c.readUInt32LE(e.LOCTIM),_.crc=c.readUInt32LE(e.LOCCRC),_.compressedSize=c.readUInt32LE(e.LOCSIZ),_.size=c.readUInt32LE(e.LOCLEN),_.fnameLen=c.readUInt16LE(e.LOCNAM),_.extraLen=c.readUInt16LE(e.LOCEXT);const p=F+e.LOCHDR+_.fnameLen,f=p+_.extraLen;return d.slice(p,f)},loadFromBinary:function(d){if(d.length!==e.CENHDR||d.readUInt32LE(0)!==e.CENSIG)throw n.Errors.INVALID_CEN();r=d.readUInt16LE(e.CENVEM),a=d.readUInt16LE(e.CENVER),l=d.readUInt16LE(e.CENFLG),u=d.readUInt16LE(e.CENHOW),o=d.readUInt32LE(e.CENTIM),s=d.readUInt32LE(e.CENCRC),t=d.readUInt32LE(e.CENSIZ),i=d.readUInt32LE(e.CENLEN),g=d.readUInt16LE(e.CENNAM),E=d.readUInt16LE(e.CENEXT),v=d.readUInt16LE(e.CENCOM),m=d.readUInt16LE(e.CENDSK),I=d.readUInt16LE(e.CENATT),D=d.readUInt32LE(e.CENATX),F=d.readUInt32LE(e.CENOFF)},localHeaderToBinary:function(){var d=Buffer.alloc(e.LOCHDR);return d.writeUInt32LE(e.LOCSIG,0),d.writeUInt16LE(a,e.LOCVER),d.writeUInt16LE(l,e.LOCFLG),d.writeUInt16LE(u,e.LOCHOW),d.writeUInt32LE(o,e.LOCTIM),d.writeUInt32LE(s,e.LOCCRC),d.writeUInt32LE(t,e.LOCSIZ),d.writeUInt32LE(i,e.LOCLEN),d.writeUInt16LE(g,e.LOCNAM),d.writeUInt16LE(_.extraLen,e.LOCEXT),d},centralHeaderToBinary:function(){var d=Buffer.alloc(e.CENHDR+g+E+v);return d.writeUInt32LE(e.CENSIG,0),d.writeUInt16LE(r,e.CENVEM),d.writeUInt16LE(a,e.CENVER),d.writeUInt16LE(l,e.CENFLG),d.writeUInt16LE(u,e.CENHOW),d.writeUInt32LE(o,e.CENTIM),d.writeUInt32LE(s,e.CENCRC),d.writeUInt32LE(t,e.CENSIZ),d.writeUInt32LE(i,e.CENLEN),d.writeUInt16LE(g,e.CENNAM),d.writeUInt16LE(E,e.CENEXT),d.writeUInt16LE(v,e.CENCOM),d.writeUInt16LE(m,e.CENDSK),d.writeUInt16LE(I,e.CENATT),d.writeUInt32LE(D,e.CENATX),d.writeUInt32LE(F,e.CENOFF),d},toJSON:function(){const d=function(c){return c+" bytes"};return{made:r,version:a,flags:l,method:n.methodToString(u),time:this.time,crc:"0x"+s.toString(16).toUpperCase(),compressedSize:d(t),size:d(i),fileNameLength:d(g),extraLength:d(E),commentLength:d(v),diskNumStart:m,inAttr:I,attr:D,offset:F,centralHeaderSize:d(e.CENHDR+g+E+v)}},toString:function(){return JSON.stringify(this.toJSON(),null,"	")}}},ge}var Ee,Je;function pt(){if(Je)return Ee;Je=1;var n=oe(),e=n.Constants;return Ee=function(){var r=0,a=0,l=0,u=0,o=0;return{get diskEntries(){return r},set diskEntries(s){r=a=s},get totalEntries(){return a},set totalEntries(s){a=r=s},get size(){return l},set size(s){l=s},get offset(){return u},set offset(s){u=s},get commentLength(){return o},set commentLength(s){o=s},get mainHeaderSize(){return e.ENDHDR+o},loadFromBinary:function(s){if((s.length!==e.ENDHDR||s.readUInt32LE(0)!==e.ENDSIG)&&(s.length<e.ZIP64HDR||s.readUInt32LE(0)!==e.ZIP64SIG))throw n.Errors.INVALID_END();s.readUInt32LE(0)===e.ENDSIG?(r=s.readUInt16LE(e.ENDSUB),a=s.readUInt16LE(e.ENDTOT),l=s.readUInt32LE(e.ENDSIZ),u=s.readUInt32LE(e.ENDOFF),o=s.readUInt16LE(e.ENDCOM)):(r=n.readBigUInt64LE(s,e.ZIP64SUB),a=n.readBigUInt64LE(s,e.ZIP64TOT),l=n.readBigUInt64LE(s,e.ZIP64SIZE),u=n.readBigUInt64LE(s,e.ZIP64OFF),o=0)},toBinary:function(){var s=Buffer.alloc(e.ENDHDR+o);return s.writeUInt32LE(e.ENDSIG,0),s.writeUInt32LE(0,4),s.writeUInt16LE(r,e.ENDSUB),s.writeUInt16LE(a,e.ENDTOT),s.writeUInt32LE(l,e.ENDSIZ),s.writeUInt32LE(u,e.ENDOFF),s.writeUInt16LE(o,e.ENDCOM),s.fill(" ",e.ENDHDR),s},toJSON:function(){const s=function(t,i){let g=t.toString(16).toUpperCase();for(;g.length<i;)g="0"+g;return"0x"+g};return{diskEntries:r,totalEntries:a,size:l+" bytes",offset:s(u,4),commentLength:o}},toString:function(){return JSON.stringify(this.toJSON(),null,"	")}}},Ee}var ze;function rt(){return ze||(ze=1,ae.EntryHeader=ht(),ae.MainHeader=pt()),ae}var te={},ye,Ze;function mt(){return Ze||(Ze=1,ye=function(n){var e=et,r={chunkSize:(parseInt(n.length/1024)+1)*1024};return{deflate:function(){return e.deflateRawSync(n,r)},deflateAsync:function(a){var l=e.createDeflateRaw(r),u=[],o=0;l.on("data",function(s){u.push(s),o+=s.length}),l.on("end",function(){var s=Buffer.alloc(o),t=0;s.fill(0);for(var i=0;i<u.length;i++){var g=u[i];g.copy(s,t),t+=g.length}a&&a(s)}),l.end(n)}}}),ye}var Le,ke;function gt(){if(ke)return Le;ke=1;const n=+(process.versions?process.versions.node:"").split(".")[0]||0;return Le=function(e,r){var a=et;const l=n>=15&&r>0?{maxOutputLength:r}:{};return{inflate:function(){return a.inflateRawSync(e,l)},inflateAsync:function(u){var o=a.createInflateRaw(l),s=[],t=0;o.on("data",function(i){s.push(i),t+=i.length}),o.on("end",function(){var i=Buffer.alloc(t),g=0;i.fill(0);for(var E=0;E<s.length;E++){var v=s[E];v.copy(i,g),g+=v.length}u&&u(i)}),o.end(e)}}},Le}var we,qe;function Et(){if(qe)return we;qe=1;const{randomFillSync:n}=xe,e=Fe(),r=new Uint32Array(256).map((m,I)=>{for(let D=0;D<8;D++)(I&1)!==0?I=I>>>1^3988292384:I>>>=1;return I>>>0}),a=(m,I)=>Math.imul(m,I)>>>0,l=(m,I)=>r[(m^I)&255]^m>>>8,u=()=>typeof n=="function"?n(Buffer.alloc(12)):u.node();u.node=()=>{const m=Buffer.alloc(12),I=m.length;for(let D=0;D<I;D++)m[D]=Math.random()*256&255;return m};const o={genSalt:u};function s(m){const I=Buffer.isBuffer(m)?m:Buffer.from(m);this.keys=new Uint32Array([305419896,591751049,878082192]);for(let D=0;D<I.length;D++)this.updateKeys(I[D])}s.prototype.updateKeys=function(m){const I=this.keys;return I[0]=l(I[0],m),I[1]+=I[0]&255,I[1]=a(I[1],134775813)+1,I[2]=l(I[2],I[1]>>>24),m},s.prototype.next=function(){const m=(this.keys[2]|2)>>>0;return a(m,m^1)>>8&255};function t(m){const I=new s(m);return function(D){const F=Buffer.alloc(D.length);let _=0;for(let w of D)F[_++]=I.updateKeys(w^I.next());return F}}function i(m){const I=new s(m);return function(D,F,_=0){F||(F=Buffer.alloc(D.length));for(let w of D){const S=I.next();F[_++]=w^S,I.updateKeys(w)}return F}}function g(m,I,D){if(!m||!Buffer.isBuffer(m)||m.length<12)return Buffer.alloc(0);const F=t(D),_=F(m.slice(0,12)),w=(I.flags&8)===8?I.timeHighByte:I.crc>>>24;if(_[11]!==w)throw e.WRONG_PASSWORD();return F(m.slice(12))}function E(m){Buffer.isBuffer(m)&&m.length>=12?o.genSalt=function(){return m.slice(0,12)}:m==="node"?o.genSalt=u.node:o.genSalt=u}function v(m,I,D,F=!1){m==null&&(m=Buffer.alloc(0)),Buffer.isBuffer(m)||(m=Buffer.from(m.toString()));const _=i(D),w=o.genSalt();w[11]=I.crc>>>24&255,F&&(w[10]=I.crc>>>16&255);const S=Buffer.alloc(m.length+12);return _(w,S),_(m,S,12)}return we={decrypt:g,encrypt:v,_salter:E},we}var Ve;function yt(){return Ve||(Ve=1,te.Deflater=mt(),te.Inflater=gt(),te.ZipCrypto=Et()),te}var ve,Ge;function nt(){if(Ge)return ve;Ge=1;var n=oe(),e=rt(),r=n.Constants,a=yt();return ve=function(l,u){var o=new e.EntryHeader,s=Buffer.alloc(0),t=Buffer.alloc(0),i=!1,g=null,E=Buffer.alloc(0),v=Buffer.alloc(0),m=!0;const I=l,D=typeof I.decoder=="object"?I.decoder:n.decoder;m=D.hasOwnProperty("efs")?D.efs:!1;function F(){return!u||!(u instanceof Uint8Array)?Buffer.alloc(0):(v=o.loadLocalHeaderFromBinary(u),u.slice(o.realDataOffset,o.realDataOffset+o.compressedSize))}function _(f){if(o.flags_desc){const h={},y=o.realDataOffset+o.compressedSize;if(u.readUInt32LE(y)==r.LOCSIG||u.readUInt32LE(y)==r.CENSIG)throw n.Errors.DESCRIPTOR_NOT_EXIST();if(u.readUInt32LE(y)==r.EXTSIG)h.crc=u.readUInt32LE(y+r.EXTCRC),h.compressedSize=u.readUInt32LE(y+r.EXTSIZ),h.size=u.readUInt32LE(y+r.EXTLEN);else if(u.readUInt16LE(y+12)===19280)h.crc=u.readUInt32LE(y+r.EXTCRC-4),h.compressedSize=u.readUInt32LE(y+r.EXTSIZ-4),h.size=u.readUInt32LE(y+r.EXTLEN-4);else throw n.Errors.DESCRIPTOR_UNKNOWN();if(h.compressedSize!==o.compressedSize||h.size!==o.size||h.crc!==o.crc)throw n.Errors.DESCRIPTOR_FAULTY();if(n.crc32(f)!==h.crc)return!1}else if(n.crc32(f)!==o.localHeader.crc)return!1;return!0}function w(f,h,y){if(typeof h>"u"&&typeof f=="string"&&(y=f,f=void 0),i)return f&&h&&h(Buffer.alloc(0),n.Errors.DIRECTORY_CONTENT_ERROR()),Buffer.alloc(0);var T=F();if(T.length===0)return f&&h&&h(T),T;if(o.encrypted){if(typeof y!="string"&&!Buffer.isBuffer(y))throw n.Errors.INVALID_PASS_PARAM();T=a.ZipCrypto.decrypt(T,o,y)}var O=Buffer.alloc(o.size);switch(o.method){case n.Constants.STORED:if(T.copy(O),_(O))return f&&h&&h(O),O;throw f&&h&&h(O,n.Errors.BAD_CRC()),n.Errors.BAD_CRC();case n.Constants.DEFLATED:var P=new a.Inflater(T,o.size);if(f)P.inflateAsync(function(C){C.copy(C,0),h&&(_(C)?h(C):h(C,n.Errors.BAD_CRC()))});else{if(P.inflate(O).copy(O,0),!_(O))throw n.Errors.BAD_CRC(`"${D.decode(s)}"`);return O}break;default:throw f&&h&&h(Buffer.alloc(0),n.Errors.UNKNOWN_METHOD()),n.Errors.UNKNOWN_METHOD()}}function S(f,h){if((!g||!g.length)&&Buffer.isBuffer(u))return f&&h&&h(F()),F();if(g.length&&!i){var y;switch(o.method){case n.Constants.STORED:return o.compressedSize=o.size,y=Buffer.alloc(g.length),g.copy(y),f&&h&&h(y),y;default:case n.Constants.DEFLATED:var T=new a.Deflater(g);if(f)T.deflateAsync(function(P){y=Buffer.alloc(P.length),o.compressedSize=P.length,P.copy(y),h&&h(y)});else{var O=T.deflate();return o.compressedSize=O.length,O}T=null;break}}else if(f&&h)h(Buffer.alloc(0));else return Buffer.alloc(0)}function d(f,h){return(f.readUInt32LE(h+4)<<4)+f.readUInt32LE(h)}function c(f){try{for(var h=0,y,T,O;h+4<f.length;)y=f.readUInt16LE(h),h+=2,T=f.readUInt16LE(h),h+=2,O=f.slice(h,h+T),h+=T,r.ID_ZIP64===y&&p(O)}catch{throw n.Errors.EXTRA_FIELD_PARSE_ERROR()}}function p(f){var h,y,T,O;f.length>=r.EF_ZIP64_SCOMP&&(h=d(f,r.EF_ZIP64_SUNCOMP),o.size===r.EF_ZIP64_OR_32&&(o.size=h)),f.length>=r.EF_ZIP64_RHO&&(y=d(f,r.EF_ZIP64_SCOMP),o.compressedSize===r.EF_ZIP64_OR_32&&(o.compressedSize=y)),f.length>=r.EF_ZIP64_DSN&&(T=d(f,r.EF_ZIP64_RHO),o.offset===r.EF_ZIP64_OR_32&&(o.offset=T)),f.length>=r.EF_ZIP64_DSN+4&&(O=f.readUInt32LE(r.EF_ZIP64_DSN),o.diskNumStart===r.EF_ZIP64_OR_16&&(o.diskNumStart=O))}return{get entryName(){return D.decode(s)},get rawEntryName(){return s},set entryName(f){s=n.toBuffer(f,D.encode);var h=s[s.length-1];i=h===47||h===92,o.fileNameLength=s.length},get efs(){return typeof m=="function"?m(this.entryName):m},get extra(){return E},set extra(f){E=f,o.extraLength=f.length,c(f)},get comment(){return D.decode(t)},set comment(f){if(t=n.toBuffer(f,D.encode),o.commentLength=t.length,t.length>65535)throw n.Errors.COMMENT_TOO_LONG()},get name(){var f=D.decode(s);return i?f.substr(f.length-1).split("/").pop():f.split("/").pop()},get isDirectory(){return i},getCompressedData:function(){return S(!1,null)},getCompressedDataAsync:function(f){S(!0,f)},setData:function(f){g=n.toBuffer(f,n.decoder.encode),!i&&g.length?(o.size=g.length,o.method=n.Constants.DEFLATED,o.crc=n.crc32(f),o.changed=!0):o.method=n.Constants.STORED},getData:function(f){return o.changed?g:w(!1,null,f)},getDataAsync:function(f,h){o.changed?f(g):w(!0,f,h)},set attr(f){o.attr=f},get attr(){return o.attr},set header(f){o.loadFromBinary(f)},get header(){return o},packCentralHeader:function(){o.flags_efs=this.efs,o.extraLength=E.length;var f=o.centralHeaderToBinary(),h=n.Constants.CENHDR;return s.copy(f,h),h+=s.length,E.copy(f,h),h+=o.extraLength,t.copy(f,h),f},packLocalHeader:function(){let f=0;o.flags_efs=this.efs,o.extraLocalLength=v.length;const h=o.localHeaderToBinary(),y=Buffer.alloc(h.length+s.length+o.extraLocalLength);return h.copy(y,f),f+=h.length,s.copy(y,f),f+=s.length,v.copy(y,f),f+=v.length,y},toJSON:function(){const f=function(h){return"<"+(h&&h.length+" bytes buffer"||"null")+">"};return{entryName:this.entryName,name:this.name,comment:this.comment,isDirectory:this.isDirectory,header:o.toJSON(),compressedData:f(u),data:f(g)}},toString:function(){return JSON.stringify(this.toJSON(),null,"	")}}},ve}var Ie,We;function Lt(){if(We)return Ie;We=1;const n=nt(),e=rt(),r=oe();return Ie=function(a,l){var u=[],o={},s=Buffer.alloc(0),t=new e.MainHeader,i=!1;const g=new Set,E=l,{noSort:v,decoder:m}=E;a?F(E.readEntries):i=!0;function I(){const w=new Set;for(const S of Object.keys(o)){const d=S.split("/");if(d.pop(),!!d.length)for(let c=0;c<d.length;c++){const p=d.slice(0,c+1).join("/")+"/";w.add(p)}}for(const S of w)if(!(S in o)){const d=new n(E);d.entryName=S,d.attr=16,d.temporary=!0,u.push(d),o[d.entryName]=d,g.add(d)}}function D(){if(i=!0,o={},t.diskEntries>(a.length-t.offset)/r.Constants.CENHDR)throw r.Errors.DISK_ENTRY_TOO_LARGE();u=new Array(t.diskEntries);for(var w=t.offset,S=0;S<u.length;S++){var d=w,c=new n(E,a);c.header=a.slice(d,d+=r.Constants.CENHDR),c.entryName=a.slice(d,d+=c.header.fileNameLength),c.header.extraLength&&(c.extra=a.slice(d,d+=c.header.extraLength)),c.header.commentLength&&(c.comment=a.slice(d,d+c.header.commentLength)),w+=c.header.centralHeaderSize,u[S]=c,o[c.entryName]=c}g.clear(),I()}function F(w){var S=a.length-r.Constants.ENDHDR,d=Math.max(0,S-65535),c=d,p=a.length,f=-1,h=0;for((typeof E.trailingSpace=="boolean"?E.trailingSpace:!1)&&(d=0),S;S>=c;S--)if(a[S]===80){if(a.readUInt32LE(S)===r.Constants.ENDSIG){f=S,h=S,p=S+r.Constants.ENDHDR,c=S-r.Constants.END64HDR;continue}if(a.readUInt32LE(S)===r.Constants.END64SIG){c=d;continue}if(a.readUInt32LE(S)===r.Constants.ZIP64SIG){f=S,p=S+r.readBigUInt64LE(a,S+r.Constants.ZIP64SIZE)+r.Constants.ZIP64LEAD;break}}if(f==-1)throw r.Errors.INVALID_FORMAT();t.loadFromBinary(a.slice(f,p)),t.commentLength&&(s=a.slice(h+r.Constants.ENDHDR)),w&&D()}function _(){u.length>1&&!v&&u.sort((w,S)=>w.entryName.toLowerCase().localeCompare(S.entryName.toLowerCase()))}return{get entries(){return i||D(),u.filter(w=>!g.has(w))},get comment(){return m.decode(s)},set comment(w){s=r.toBuffer(w,m.encode),t.commentLength=s.length},getEntryCount:function(){return i?u.length:t.diskEntries},forEach:function(w){this.entries.forEach(w)},getEntry:function(w){return i||D(),o[w]||null},setEntry:function(w){i||D(),u.push(w),o[w.entryName]=w,t.totalEntries=u.length},deleteFile:function(w,S=!0){i||D();const d=o[w];this.getEntryChildren(d,S).map(p=>p.entryName).forEach(this.deleteEntry)},deleteEntry:function(w){i||D();const S=o[w],d=u.indexOf(S);d>=0&&(u.splice(d,1),delete o[w],t.totalEntries=u.length)},getEntryChildren:function(w,S=!0){if(i||D(),typeof w=="object")if(w.isDirectory&&S){const d=[],c=w.entryName;for(const p of u)p.entryName.startsWith(c)&&d.push(p);return d}else return[w];return[]},getChildCount:function(w){if(w&&w.isDirectory){const S=this.getEntryChildren(w);return S.includes(w)?S.length-1:S.length}return 0},compressToBuffer:function(){i||D(),_();const w=[],S=[];let d=0,c=0;t.size=0,t.offset=0;let p=0;for(const y of this.entries){const T=y.getCompressedData();y.header.offset=c;const O=y.packLocalHeader(),P=O.length+T.length;c+=P,w.push(O),w.push(T);const C=y.packCentralHeader();S.push(C),t.size+=C.length,d+=P+C.length,p++}d+=t.mainHeaderSize,t.offset=c,t.totalEntries=p,c=0;const f=Buffer.alloc(d);for(const y of w)y.copy(f,c),c+=y.length;for(const y of S)y.copy(f,c),c+=y.length;const h=t.toBinary();return s&&s.copy(h,r.Constants.ENDHDR),h.copy(f,c),a=f,i=!1,f},toAsyncBuffer:function(w,S,d,c){try{i||D(),_();const p=[],f=[];let h=0,y=0,T=0;t.size=0,t.offset=0;const O=function(P){if(P.length>0){const C=P.shift(),j=C.entryName+C.extra.toString();d&&d(j),C.getCompressedDataAsync(function(b){c&&c(j),C.header.offset=y;const B=C.packLocalHeader(),$=B.length+b.length;y+=$,p.push(B),p.push(b);const M=C.packCentralHeader();f.push(M),t.size+=M.length,h+=$+M.length,T++,O(P)})}else{h+=t.mainHeaderSize,t.offset=y,t.totalEntries=T,y=0;const C=Buffer.alloc(h);p.forEach(function(b){b.copy(C,y),y+=b.length}),f.forEach(function(b){b.copy(C,y),y+=b.length});const j=t.toBinary();s&&s.copy(j,r.Constants.ENDHDR),j.copy(C,y),a=C,i=!1,w(C)}};O(Array.from(this.entries))}catch(p){S(p)}}}},Ie}var Ce,Xe;function wt(){if(Xe)return Ce;Xe=1;const n=oe(),e=L,r=nt(),a=Lt(),l=(...t)=>n.findLast(t,i=>typeof i=="boolean"),u=(...t)=>n.findLast(t,i=>typeof i=="string"),o=(...t)=>n.findLast(t,i=>typeof i=="function"),s={noSort:!1,readEntries:!1,method:n.Constants.NONE,fs:null};return Ce=function(t,i){let g=null;const E=Object.assign(Object.create(null),s);t&&typeof t=="object"&&(t instanceof Uint8Array||(Object.assign(E,t),t=E.input?E.input:void 0,E.input&&delete E.input),Buffer.isBuffer(t)&&(g=t,E.method=n.Constants.BUFFER,t=void 0)),Object.assign(E,i);const v=new n(E);if((typeof E.decoder!="object"||typeof E.decoder.encode!="function"||typeof E.decoder.decode!="function")&&(E.decoder=n.decoder),t&&typeof t=="string")if(v.fs.existsSync(t))E.method=n.Constants.FILE,E.filename=t,g=v.fs.readFileSync(t);else throw n.Errors.INVALID_FILENAME();const m=new a(g,E),{canonical:I,sanitize:D,zipnamefix:F}=n;function _(c){if(c&&m){var p;if(typeof c=="string"&&(p=m.getEntry(e.posix.normalize(c))),typeof c=="object"&&typeof c.entryName<"u"&&typeof c.header<"u"&&(p=m.getEntry(c.entryName)),p)return p}return null}function w(c){const{join:p,normalize:f,sep:h}=e.posix;return p(".",f(h+c.split("\\").join(h)+h))}function S(c){return c instanceof RegExp?(function(p){return function(f){return p.test(f)}})(c):typeof c!="function"?()=>!0:c}const d=(c,p)=>{let f=p.slice(-1);return f=f===v.sep?v.sep:"",e.relative(c,p)+f};return{readFile:function(c,p){var f=_(c);return f&&f.getData(p)||null},childCount:function(c){const p=_(c);if(p)return m.getChildCount(p)},readFileAsync:function(c,p){var f=_(c);f?f.getDataAsync(p):p(null,"getEntry failed for:"+c)},readAsText:function(c,p){var f=_(c);if(f){var h=f.getData();if(h&&h.length)return h.toString(p||"utf8")}return""},readAsTextAsync:function(c,p,f){var h=_(c);h?h.getDataAsync(function(y,T){if(T){p(y,T);return}y&&y.length?p(y.toString(f||"utf8")):p("")}):p("")},deleteFile:function(c,p=!0){var f=_(c);f&&m.deleteFile(f.entryName,p)},deleteEntry:function(c){var p=_(c);p&&m.deleteEntry(p.entryName)},addZipComment:function(c){m.comment=c},getZipComment:function(){return m.comment||""},addZipEntryComment:function(c,p){var f=_(c);f&&(f.comment=p)},getZipEntryComment:function(c){var p=_(c);return p&&p.comment||""},updateFile:function(c,p){var f=_(c);f&&f.setData(p)},addLocalFile:function(c,p,f,h){if(v.fs.existsSync(c)){p=p?w(p):"";const y=e.win32.basename(e.win32.normalize(c));p+=f||y;const T=v.fs.statSync(c),O=T.isFile()?v.fs.readFileSync(c):Buffer.alloc(0);T.isDirectory()&&(p+=v.sep),this.addFile(p,O,h,T)}else throw n.Errors.FILE_NOT_FOUND(c)},addLocalFileAsync:function(c,p){c=typeof c=="object"?c:{localPath:c};const f=e.resolve(c.localPath),{comment:h}=c;let{zipPath:y,zipName:T}=c;const O=this;v.fs.stat(f,function(P,C){if(P)return p(P,!1);y=y?w(y):"";const j=e.win32.basename(e.win32.normalize(f));if(y+=T||j,C.isFile())v.fs.readFile(f,function(b,B){return b?p(b,!1):(O.addFile(y,B,h,C),setImmediate(p,void 0,!0))});else if(C.isDirectory())return y+=v.sep,O.addFile(y,Buffer.alloc(0),h,C),setImmediate(p,void 0,!0)})},addLocalFolder:function(c,p,f){if(f=S(f),p=p?w(p):"",c=e.normalize(c),v.fs.existsSync(c)){const h=v.findFiles(c),y=this;if(h.length)for(const T of h){const O=e.join(p,d(c,T));f(O)&&y.addLocalFile(T,e.dirname(O))}}else throw n.Errors.FILE_NOT_FOUND(c)},addLocalFolderAsync:function(c,p,f,h){h=S(h),f=f?w(f):"",c=e.normalize(c);var y=this;v.fs.open(c,"r",function(T){if(T&&T.code==="ENOENT")p(void 0,n.Errors.FILE_NOT_FOUND(c));else if(T)p(void 0,T);else{var O=v.findFiles(c),P=-1,C=function(){if(P+=1,P<O.length){var j=O[P],b=d(c,j).split("\\").join("/");b=b.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^\x20-\x7E]/g,""),h(b)?v.fs.stat(j,function(B,$){B&&p(void 0,B),$.isFile()?v.fs.readFile(j,function(M,z){M?p(void 0,M):(y.addFile(f+b,z,"",$),C())}):(y.addFile(f+b+"/",Buffer.alloc(0),"",$),C())}):process.nextTick(()=>{C()})}else p(!0,void 0)};C()}})},addLocalFolderAsync2:function(c,p){const f=this;c=typeof c=="object"?c:{localPath:c},localPath=e.resolve(w(c.localPath));let{zipPath:h,filter:y,namefix:T}=c;y instanceof RegExp?y=(function(C){return function(j){return C.test(j)}})(y):typeof y!="function"&&(y=function(){return!0}),h=h?w(h):"",T=="latin1"&&(T=C=>C.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^\x20-\x7E]/g,"")),typeof T!="function"&&(T=C=>C);const O=C=>e.join(h,T(d(localPath,C))),P=C=>e.win32.basename(e.win32.normalize(T(C)));v.fs.open(localPath,"r",function(C){C&&C.code==="ENOENT"?p(void 0,n.Errors.FILE_NOT_FOUND(localPath)):C?p(void 0,C):v.findFilesAsync(localPath,function(j,b){if(j)return p(j);b=b.filter(B=>y(O(B))),b.length||p(void 0,!1),setImmediate(b.reverse().reduce(function(B,$){return function(M,z){if(M||z===!1)return setImmediate(B,M,!1);f.addLocalFileAsync({localPath:$,zipPath:e.dirname(O($)),zipName:P($)},B)}},p))})})},addLocalFolderPromise:function(c,p){return new Promise((f,h)=>{this.addLocalFolderAsync2(Object.assign({localPath:c},p),(y,T)=>{y&&h(y),T&&f(this)})})},addFile:function(c,p,f,h){c=F(c);let y=_(c);const T=y!=null;T||(y=new r(E),y.entryName=c),y.comment=f||"";const O=typeof h=="object"&&h instanceof v.fs.Stats;O&&(y.header.time=h.mtime);var P=y.isDirectory?16:0;let C=y.isDirectory?16384:32768;return O?C|=4095&h.mode:typeof h=="number"?C|=4095&h:C|=y.isDirectory?493:420,P=(P|C<<16)>>>0,y.attr=P,y.setData(p),T||m.setEntry(y),y},getEntries:function(c){return m.password=c,m?m.entries:[]},getEntry:function(c){return _(c)},getEntryCount:function(){return m.getEntryCount()},forEach:function(c){return m.forEach(c)},extractEntryTo:function(c,p,f,h,y,T){h=l(!1,h),y=l(!1,y),f=l(!0,f),T=u(y,T);var O=_(c);if(!O)throw n.Errors.NO_ENTRY();var P=I(O.entryName),C=D(p,T&&!O.isDirectory?T:f?P:e.basename(P));if(O.isDirectory){var j=m.getEntryChildren(O);return j.forEach(function($){if($.isDirectory)return;var M=$.getData();if(!M)throw n.Errors.CANT_EXTRACT_FILE();var z=I($.entryName),K=D(p,f?z:e.basename(z));const G=y?$.header.fileAttr:void 0;v.writeFileTo(K,M,h,G)}),!0}var b=O.getData(m.password);if(!b)throw n.Errors.CANT_EXTRACT_FILE();if(v.fs.existsSync(C)&&!h)throw n.Errors.CANT_OVERRIDE();const B=y?c.header.fileAttr:void 0;return v.writeFileTo(C,b,h,B),!0},test:function(c){if(!m)return!1;for(var p in m.entries)try{if(p.isDirectory)continue;var f=m.entries[p].getData(c);if(!f)return!1}catch{return!1}return!0},extractAllTo:function(c,p,f,h){if(f=l(!1,f),h=u(f,h),p=l(!1,p),!m)throw n.Errors.NO_ZIP();m.entries.forEach(function(y){var T=D(c,I(y.entryName));if(y.isDirectory){v.makeDir(T);return}var O=y.getData(h);if(!O)throw n.Errors.CANT_EXTRACT_FILE();const P=f?y.header.fileAttr:void 0;v.writeFileTo(T,O,p,P);try{v.fs.utimesSync(T,y.header.time,y.header.time)}catch{throw n.Errors.CANT_EXTRACT_FILE()}})},extractAllToAsync:function(c,p,f,h){if(h=o(p,f,h),f=l(!1,f),p=l(!1,p),!h)return new Promise((C,j)=>{this.extractAllToAsync(c,p,f,function(b){b?j(b):C(this)})});if(!m){h(n.Errors.NO_ZIP());return}c=e.resolve(c);const y=C=>D(c,e.normalize(I(C.entryName))),T=(C,j)=>new Error(C+': "'+j+'"'),O=[],P=[];m.entries.forEach(C=>{C.isDirectory?O.push(C):P.push(C)});for(const C of O){const j=y(C),b=f?C.header.fileAttr:void 0;try{v.makeDir(j),b&&v.fs.chmodSync(j,b),v.fs.utimesSync(j,C.header.time,C.header.time)}catch{h(T("Unable to create folder",j))}}P.reverse().reduce(function(C,j){return function(b){if(b)C(b);else{const B=e.normalize(I(j.entryName)),$=D(c,B);j.getDataAsync(function(M,z){if(z)C(z);else if(!M)C(n.Errors.CANT_EXTRACT_FILE());else{const K=f?j.header.fileAttr:void 0;v.writeFileToAsync($,M,p,K,function(G){G||C(T("Unable to write file",$)),v.fs.utimes($,j.header.time,j.header.time,function(ie){ie?C(T("Unable to set times",$)):C()})})}})}}},h)()},writeZip:function(c,p){if(arguments.length===1&&typeof c=="function"&&(p=c,c=""),!c&&E.filename&&(c=E.filename),!!c){var f=m.compressToBuffer();if(f){var h=v.writeFileTo(c,f,!0);typeof p=="function"&&p(h?null:new Error("failed"),"")}}},writeZipPromise:function(c,p){const{overwrite:f,perm:h}=Object.assign({overwrite:!0},p);return new Promise((y,T)=>{!c&&E.filename&&(c=E.filename),c||T("ADM-ZIP: ZIP File Name Missing"),this.toBufferPromise().then(O=>{const P=C=>C?y(C):T("ADM-ZIP: Wasn't able to write zip file");v.writeFileToAsync(c,O,f,h,P)},T)})},toBufferPromise:function(){return new Promise((c,p)=>{m.toAsyncBuffer(c,p)})},toBuffer:function(c,p,f,h){return typeof c=="function"?(m.toAsyncBuffer(c,p,f,h),null):m.compressToBuffer()}}},Ce}var vt=wt();const It=lt(vt),ot=()=>{const n={},e=[L.join(process.resourcesPath||"","app",".env"),L.join(process.resourcesPath||"",".env"),L.join(process.cwd(),".env"),L.join(__dirname,"..",".env"),L.join(__dirname,"..","..",".env"),L.join(L.dirname(process.execPath),".env")];try{const r=require("electron"),a=r.app||r.default?.app;if(a&&typeof a.getAppPath=="function")try{const l=a.getAppPath();l&&(e.push(L.join(l,".env")),e.push(L.join(L.dirname(l),".env")),e.push(L.join(L.dirname(l),"..",".env")))}catch{}}catch{}for(const r of e)try{if(x.existsSync(r)){x.readFileSync(r,"utf-8").split(`
`).forEach(l=>{const u=l.trim();if(u&&!u.startsWith("#")){const[o,...s]=u.split("=");if(o&&s.length>0){const t=s.join("=").trim().replace(/^["']|["']$/g,"");n[o.trim()]=t}}}),console.log(`[Electron Config] Loaded .env from: ${r}`);break}}catch{}return n},st=()=>{let n=process.env.VITE_API_URL;return n||(n=ot().VITE_API_URL),n?n.replace(/\/$/,""):process.env.NODE_ENV==="development"?"http://localhost:7240":(console.warn(`⚠️  VITE_API_URL is not configured in Electron main process.
Using default production server: http://5.188.119.206:7240
Please set VITE_API_URL in .env file or pass as environment variable.
Example: VITE_API_URL=http://your-server.com:7240`),"http://5.188.119.206:7240")},Ct=()=>{let n=process.env.VITE_WS_URL;if(n||(n=ot().VITE_WS_URL),n)return n.replace(/\/$/,"");const e=st();try{const r=new URL(e);return`${r.protocol==="https:"?"wss:":"ws:"}//${r.host}/ws`}catch{return"ws://5.188.119.206/ws"}},Dt=()=>{const n=process.env.VITE_DEV_SERVER_URL;return n?n.replace(/\/$/,""):"http://localhost:5173"},Z={apiUrl:st(),wsUrl:Ct(),devServerUrl:Dt(),isDevelopment:process.env.NODE_ENV==="development",isProduction:process.env.NODE_ENV==="production"};console.log("[Electron Config]",{apiUrl:Z.apiUrl,wsUrl:Z.wsUrl,devServerUrl:Z.devServerUrl,isDevelopment:Z.isDevelopment,isProduction:Z.isProduction,env:{VITE_API_URL:process.env.VITE_API_URL||"NOT SET",VITE_WS_URL:process.env.VITE_WS_URL||"NOT SET"}});let R=null,k=null;const q=new Map,V=process.env.NODE_ENV==="development";V&&(process.env.ELECTRON_DISABLE_SECURITY_WARNINGS="true");async function it(n,e){try{const r=JSON.stringify({errorType:"ELECTRON_ERROR",errorMessage:n.message||String(n),stackTrace:n.stack||null,component:e?.component||"ElectronMain",action:e?.action||"unhandledError",os:process.platform,osVersion:Qe.release(),launcherVersion:A.app.getVersion()}),a=Z.apiUrl,l=new URL(a),u={hostname:l.hostname,port:parseInt(l.port)||7240,path:"/api/crashes/launcher-errors",method:"POST",headers:{"Content-Type":"application/json","Content-Length":Buffer.byteLength(r)},timeout:2e3},o=ne.request(u,()=>{});o.on("error",()=>{}),o.write(r),o.end()}catch(r){console.error("[ErrorLogger] Failed to log error to backend:",r)}}process.on("uncaughtException",n=>{console.error("[Electron] Uncaught Exception:",n),it(n,{component:"ElectronMain",action:"uncaughtException"})});process.on("unhandledRejection",(n,e)=>{console.error("[Electron] Unhandled Rejection:",n);const r=n instanceof Error?n:new Error(String(n));it(r,{component:"ElectronMain",action:"unhandledRejection"})});function se(){console.log(`Stopping ${q.size} active downloads...`),q.forEach((n,e)=>{try{n.request.destroy(),n.writer.destroy(),x.existsSync(n.destPath)&&x.unlinkSync(n.destPath)}catch(r){console.error(`Error stopping download ${e}:`,r)}}),q.clear()}function St(){if(!k)try{const n=Te(),e=[L.join(n,"assets","icon.png"),L.join(n,"icon.png"),L.join(process.cwd(),"assets","icon.png"),L.join(process.cwd(),"icon.png")];let r=null;for(const l of e)if(x.existsSync(l)){r=l;break}if(r)k=new A.Tray(r);else{const u=Buffer.alloc(1024);for(let t=0;t<u.length;t+=4)u[t]=20,u[t+1]=20,u[t+2]=20,u[t+3]=255;const o=(t,i)=>{if(t>=0&&t<16&&i>=0&&i<16){const g=(i*16+t)*4;u[g]=255,u[g+1]=255,u[g+2]=255}};for(let t=4;t<12;t++)o(3,t),o(12,t),t<8&&(o(3+(t-4),t),o(12-(t-4),t));const s=A.nativeImage.createFromBuffer(u,{width:16,height:16});k=new A.Tray(s)}const a=A.Menu.buildFromTemplate([{label:"Show Launcher",click:()=>{R?(R.show(),R.focus()):re()}},{label:"Quit",click:()=>{console.log("[Tray] Quit requested - closing all windows and exiting..."),se(),R&&(R.removeAllListeners("close"),R.destroy(),R=null),k&&(k.destroy(),k=null),setTimeout(()=>{A.app.exit(0)},100)}}]);k.setToolTip("Modern Launcher"),k.setContextMenu(a),k.on("click",()=>{R?R.isVisible()?R.hide():(R.show(),R.focus()):re()})}catch(n){console.error("Failed to create tray:",n)}}function Te(){if(V)return process.cwd();{const n=A.app.getAppPath();return console.log("App path:",n),console.log("__dirname:",__dirname),console.log("process.resourcesPath:",process.resourcesPath),n}}function re(){const n=Te();let e;if(V)e=L.join(n,"dist-electron","preload.js");else{const r=[L.join(__dirname,"preload.js"),L.join(n,"dist-electron","preload.js"),L.join(n,"preload.js"),L.join(process.resourcesPath,"app","dist-electron","preload.js"),L.join(process.resourcesPath,"app.asar.unpacked","preload.js")];e=r.find(a=>x.existsSync(a))||r[0],console.log("Using preload path:",e),console.log("Preload exists:",x.existsSync(e))}if(R=new A.BrowserWindow({width:1200,height:750,minWidth:900,minHeight:600,frame:!1,transparent:!1,backgroundColor:"#0a0a0a",webPreferences:{preload:e,contextIsolation:!0,nodeIntegration:!1,sandbox:!1,webSecurity:V},show:!1}),R.once("ready-to-show",()=>{R?.show()}),V){const r=Z.devServerUrl;R.loadURL(r),R.webContents.openDevTools()}else{const r=L.join(n,"dist","index.html");console.log("Production mode - Loading index.html"),console.log("App dir:",n),console.log("Index path:",r),console.log("File exists:",x.existsSync(r)),R.loadFile(r).catch(a=>{console.error("Failed to load index.html:",a),console.error("Error details:",{code:a.code,message:a.message,stack:a.stack});const l=[L.join(__dirname,"..","dist","index.html"),L.join(process.resourcesPath,"app","dist","index.html")];let u=!1;for(const o of l)if(x.existsSync(o)){console.log("Trying alternative path:",o),R.loadFile(o).catch(s=>{console.error("Alternative path also failed:",s)}),u=!0;break}if(!u){const s=`file:///${L.resolve(r).replace(/\\/g,"/")}`;console.log("Trying URL load:",s),R.loadURL(s).catch(t=>{console.error("URL load also failed:",t),process.env.ELECTRON_OPEN_DEVTOOLS==="1"&&R?.webContents.openDevTools()})}})}R.webContents.on("did-fail-load",(r,a,l,u)=>{console.error("❌ Page failed to load:",{errorCode:a,errorDescription:l,validatedURL:u}),console.error("Error code:",a),console.error("Error description:",l),console.error("Validated URL:",u),(V||process.env.ELECTRON_OPEN_DEVTOOLS==="1")&&R?.webContents.openDevTools(),R?.webContents.send("app:error",`Failed to load page: ${l}`)}),R.webContents.on("did-finish-load",()=>{console.log("✅ Page loaded successfully");const r=R?.webContents.getURL();console.log("Current URL:",r),V||R?.webContents.openDevTools()}),R.webContents.on("dom-ready",()=>{console.log("✅ DOM is ready")}),R.webContents.on("console-message",(r,a,l,u,o)=>{const t=["log","warn","info","error"][a]||"unknown";console.log(`[Renderer ${t}]:`,l),a===3&&console.error("Renderer error:",{message:l,line:u,sourceId:o})}),R.webContents.session.webRequest.onBeforeRequest((r,a)=>{(r.url.includes("/api/")||r.url.includes("5.188.119.206"))&&console.log("[Network Request]",{method:r.method,url:r.url,resourceType:r.resourceType,timestamp:new Date().toISOString()}),a({})}),R.webContents.session.webRequest.onErrorOccurred(r=>{(r.url.includes("/api/")||r.url.includes("5.188.119.206"))&&console.error("[Network Error]",{url:r.url,error:r.error,resourceType:r.resourceType,timestamp:new Date().toISOString()})}),R.webContents.session.webRequest.onCompleted(r=>{(r.url.includes("/api/")||r.url.includes("5.188.119.206"))&&console.log("[Network Response]",{method:r.method,url:r.url,statusCode:r.statusCode,timestamp:new Date().toISOString()})}),R.on("closed",()=>{R=null}),R.on("close",r=>{k&&process.platform!=="darwin"?(r.preventDefault(),R?.hide()):(se(),R&&(R.destroy(),R=null))}),R.on("minimize",()=>{})}const Ne=A.app.getPath("userData"),De=Ne.replace(/Modern Launcher/g,"Modern-Launcher");De!==Ne&&(A.app.setPath("userData",De),console.log(`[App] Set custom userData path: ${De} (original: ${Ne})`));A.app.on("session-created",n=>{n.webRequest.onHeadersReceived((e,r)=>{if(!V){r({responseHeaders:{...e.responseHeaders}});return}if(V){const a=(()=>{try{const D=new URL(Z.apiUrl).host;return console.log("[CSP] Using API host:",D,"from URL:",Z.apiUrl),D}catch(I){return console.error("[CSP] Failed to parse API URL:",Z.apiUrl,I),"5.188.119.206:7240"}})(),l=(()=>{try{const I=Z.wsUrl,F=new URL(I).host;return console.log("[CSP] Using WebSocket host:",F,"from URL:",I),F}catch(I){console.error("[CSP] Failed to parse WebSocket URL:",Z.wsUrl,I);const[D,F]=a.split(":");return F?`${D}:${F}`:D}})(),[u,o]=a.split(":"),s=o?`${u}:${o}`:u,[t,i]=l.split(":"),g=i?`${t}:${i}`:t,E=`'self' http://localhost:* http://${s} http://${u}:* ws://localhost:* ws://${s} ws://${u}:* ws://${g} ws://${t}:* wss://localhost:* wss://${s} wss://${u}:* wss://${g} wss://${t}:*`,v=`'self' 'unsafe-inline' 'unsafe-eval' http://localhost:* http://${s} http://${u}:*`,m=`'self' 'unsafe-inline' 'unsafe-eval' data: blob: http://localhost:* http://${s} http://${u}:* ws://localhost:* ws://${s} ws://${u}:* ws://${g} ws://${t}:* wss://localhost:* wss://${s} wss://${u}:* wss://${g} wss://${t}:*`;n._cspLogged||(console.log("[CSP] Content Security Policy configured for development:",{apiHost:a,hostname:u,port:o,connectSrc:E}),n._cspLogged=!0),r({responseHeaders:{...e.responseHeaders,"Content-Security-Policy":["default-src "+m+"; script-src "+v+"; style-src 'self' 'unsafe-inline'; img-src 'self' data: blob: http: https:; font-src 'self' data:; connect-src "+E+";"]}})}})});const Nt=A.app.requestSingleInstanceLock();Nt?(A.app.on("second-instance",()=>{R?(R.isMinimized()&&R.restore(),R.focus()):re()}),A.app.whenReady().then(()=>{re(),St(),A.app.on("activate",()=>{A.BrowserWindow.getAllWindows().length===0?re():R&&(R.show(),R.focus())})}),A.app.on("window-all-closed",()=>{k||process.platform!=="darwin"&&(se(),A.app.quit())})):(console.log("Another instance is already running. Exiting..."),A.app.quit(),process.exit(0));A.app.on("before-quit",()=>{se()});A.ipcMain.on("window:minimize",()=>{R?.minimize()});A.ipcMain.on("window:maximize",()=>{R?.isMaximized()?R.unmaximize():R?.maximize()});A.ipcMain.on("window:close",()=>{se(),R?.close()});A.ipcMain.on("window:minimizeToTray",()=>{R&&R.hide()});function _e(n){const e=[];try{if(!x.existsSync(n))return e;const r=x.readdirSync(n,{withFileTypes:!0});for(const a of r){const l=L.join(n,a.name);a.isDirectory()?e.push(..._e(l)):a.isFile()&&a.name.endsWith(".jar")&&e.push(l)}}catch(r){console.error(`Error reading directory ${n}:`,r)}return e}function Ke(n){const e=n.toLowerCase();return e.includes("natives-linux")?"linux":e.includes("natives-windows")||e.includes("natives-win")?"windows":e.includes("natives-macos")||e.includes("natives-osx")||e.includes("natives-mac")?"macos":null}async function _t(n,e){return new Promise((r,a)=>{try{const l=L.basename(n),u=Ke(l),o=u?L.join(e,u):e;x.existsSync(o)||x.mkdirSync(o,{recursive:!0});const t=new It(n).getEntries(),i=[];for(const g of t)if(!g.isDirectory){const E=g.entryName,v=L.extname(E).toLowerCase();(v===".dll"||v===".so"||v===".dylib")&&i.push({entry:g,name:L.basename(E)})}if(i.length===0){r();return}for(const{entry:g,name:E}of i){const v=L.join(o,E);try{const m=g.getData();x.writeFileSync(v,m)}catch(m){console.warn(`Failed to extract ${E} from ${n}:`,m.message)}}r()}catch{const u=L.basename(n),o=Ke(u),s=o?L.join(e,o):e;x.existsSync(s)||x.mkdirSync(s,{recursive:!0});const i=process.platform==="win32"?"jar xf":"unzip -o";W.exec(`${i} "${n}" -d "${s}"`,g=>{g&&console.warn(`Failed to extract natives from ${n}:`,g.message),r()})}})}async function xt(n,e){const r=L.join(n,"..","natives");if(x.existsSync(r)&&x.readdirSync(r).length>0)return console.log(`Native libraries already extracted to: ${r}`),r;const a=[];function l(u){if(x.existsSync(u))try{const o=x.readdirSync(u,{withFileTypes:!0});for(const s of o){const t=L.join(u,s.name);s.isFile()&&s.name.endsWith(".jar")?s.name.toLowerCase().includes("natives")&&a.push(t):s.isDirectory()&&l(t)}}catch{}}if(l(n),a.length===0)return console.warn(`No natives JAR files found in ${n}`),r;console.log(`Found ${a.length} natives JAR files, extracting...`),x.existsSync(r)||x.mkdirSync(r,{recursive:!0});for(const u of a)try{await _t(u,r),console.log(`Extracted natives from: ${L.basename(u)}`)}catch(o){console.warn(`Failed to extract natives from ${u}:`,o.message)}return r}function Se(n){const e=[],r=new Set,a=process.platform==="win32"?"windows":process.platform==="darwin"?"macos":"linux",l=L.join(n,"..","natives");if(x.existsSync(l)){const o=L.join(l,a);if(x.existsSync(o))x.readdirSync(o).length>0&&(e.push(o),console.log(`Using platform-specific natives: ${o}`));else{const s=x.readdirSync(l);s.length>0&&s.some(i=>{const g=L.extname(i).toLowerCase();return a==="windows"&&g===".dll"||a==="linux"&&g===".so"||a==="macos"&&g===".dylib"})&&(e.push(l),console.log(`Using legacy natives directory: ${l}`))}}function u(o){if(!(r.has(o)||!x.existsSync(o))){r.add(o);try{const s=x.readdirSync(o,{withFileTypes:!0});for(const t of s){const i=L.join(o,t.name);if(t.isDirectory()){if(t.name==="natives"){e.push(i);continue}u(i)}else if(t.isFile()){const g=L.extname(t.name).toLowerCase();(g===".dll"||g===".so"||g===".dylib")&&(e.includes(o)||e.push(o))}}}catch{}}}return u(n),Array.from(new Set(e))}function at(){if(V){const e=L.resolve(process.cwd(),"updates");if(x.existsSync(e))return console.log("Found updates in process.cwd():",e),e;const r=L.resolve(process.cwd(),"packages","backend","updates");if(x.existsSync(r))return console.log("Found updates in packages/backend/updates:",r),r;let l=Te();const u=10;let o=0;for(;o<u&&l!==L.dirname(l);){const s=L.join(l,"packages"),t=L.join(l,"updates");if(x.existsSync(s)&&x.existsSync(t))return console.log("Found updates in project root:",t),L.resolve(t);l=L.dirname(l),o++}}try{const e=A.app.getPath("appData"),r=L.join(e,"Modern-Launcher"),a=L.join(r,"updates");return x.existsSync(r)||(x.mkdirSync(r,{recursive:!0}),console.log("Created launcher data directory:",r)),x.existsSync(a)||(x.mkdirSync(a,{recursive:!0}),console.log("Created updates directory:",a)),console.log("Using updates directory in AppData/Roaming:",a),a}catch(e){console.warn("Could not create updates directory in AppData:",e)}try{const e=A.app.getAppPath();let r=L.dirname(e);for(let a=0;a<5;a++){const l=L.join(r,"updates");if(x.existsSync(l))return console.log("Found updates relative to app path:",l),L.resolve(l);r=L.dirname(r)}}catch(e){console.warn("Could not get app path:",e)}const n=L.resolve(process.cwd(),"updates");return console.log("Using default updates path:",n),n}function Ye(n){const e=n.toLowerCase();return e.includes("connection refused")||e.includes("connection.*refused")?"CONNECTION_REFUSED":e.includes("timeout")||e.includes("timed out")?"CONNECTION_TIMEOUT":e.includes("authentication")||e.includes("auth")?"AUTHENTICATION_FAILED":e.includes("server full")||e.includes("server.*full")?"SERVER_FULL":e.includes("version")&&e.includes("mismatch")?"VERSION_MISMATCH":e.includes("network")||e.includes("network.*error")?"NETWORK_ERROR":"UNKNOWN"}function Ft(){const n=[],e=process.platform==="win32",r=process.platform==="darwin",a=process.platform==="linux",l=process.env.JAVA_HOME;if(l){const u=e?L.join(l,"bin","java.exe"):L.join(l,"bin","java");x.existsSync(u)&&n.push(u)}try{W.execSync("java -version",{timeout:2e3,stdio:"pipe"}),n.push("java")}catch{}if(e){const u=process.env.ProgramFiles||"C:\\Program Files",o=process.env["ProgramFiles(x86)"]||"C:\\Program Files (x86)",s=[L.join(u,"Java"),L.join(o,"Java"),L.join(process.env.LOCALAPPDATA||"","Programs","Java"),"C:\\Program Files\\Eclipse Adoptium","C:\\Program Files\\Eclipse Foundation","C:\\Program Files\\Microsoft","C:\\Program Files\\OpenJDK"];for(const t of s)if(x.existsSync(t))try{const i=x.readdirSync(t,{withFileTypes:!0});for(const g of i)if(g.isDirectory()){const E=L.join(t,g.name,"bin","java.exe");x.existsSync(E)&&n.push(E)}}catch{}try{const i=W.execSync('reg query "HKLM\\SOFTWARE\\JavaSoft\\Java Runtime Environment" /s /v JavaHome 2>nul',{encoding:"utf-8",timeout:3e3,stdio:"pipe"}).match(/JavaHome\s+REG_SZ\s+(.+)/g);if(i)for(const g of i){const E=g.replace(/JavaHome\s+REG_SZ\s+/,"").trim(),v=L.join(E,"bin","java.exe");x.existsSync(v)&&!n.includes(v)&&n.push(v)}}catch{}}if(r){const u=["/Library/Java/JavaVirtualMachines","/System/Library/Java/JavaVirtualMachines","/usr/libexec/java_home"];for(const o of u)if(x.existsSync(o))try{const s=x.readdirSync(o,{withFileTypes:!0});for(const t of s)if(t.isDirectory()){const i=L.join(o,t.name,"Contents","Home","bin","java");x.existsSync(i)&&n.push(i)}}catch{}try{const s=W.execSync("/usr/libexec/java_home -V",{timeout:2e3,stdio:"pipe",encoding:"utf-8"}).match(/\/Library\/Java\/JavaVirtualMachines\/[^\s]+/g);if(s)for(const t of s){const i=L.join(t,"Contents","Home","bin","java");x.existsSync(i)&&!n.includes(i)&&n.push(i)}}catch{}}if(a){const u=["/usr/lib/jvm","/usr/java","/opt/java","/usr/local/java"];for(const o of u)if(x.existsSync(o))try{const s=x.readdirSync(o,{withFileTypes:!0});for(const t of s)if(t.isDirectory()){const i=L.join(o,t.name,"bin","java");x.existsSync(i)&&!n.includes(i)&&n.push(i)}}catch{}}return Array.from(new Set(n))}function Q(n){try{const e=W.execSync(`"${n}" -version 2>&1`,{timeout:5e3,encoding:"utf-8",stdio:"pipe"}),r=e.match(/version\s+"?(\d+)(?:\.(\d+))?(?:\.(\d+))?(?:_(\d+))?"?/);if(r){const a=parseInt(r[1],10),l=r[2]?parseInt(r[2],10):0,u=r[3]?parseInt(r[3],10):0,o=r[4]?parseInt(r[4],10):0,s=a===1&&l>0?l:a;return{version:`${s}.${u||0}`,major:s,full:e.split(`
`)[0]||e}}return null}catch(e){return console.error(`Failed to get Java version from ${n}:`,e),null}}function ct(n,e){const r=Q(n);if(!r)return{valid:!1,requiredVersion:e,error:`Failed to determine Java version from ${n}`};const a=parseInt(e,10),l=r.major>=a;return{valid:l,currentVersion:r.version,requiredVersion:e,error:l?void 0:`Java ${r.major} is installed, but Java ${a} or higher is required`}}A.ipcMain.handle("launcher:launch",async(n,e)=>{const{javaPath:r,jvmArgs:a,mainClass:l,classPath:u,gameArgs:o,workingDir:s,version:t,clientDirectory:i,jvmVersion:g,profileId:E,serverAddress:v,serverPort:m,userId:I,username:D}=e;try{const F=at();console.log("Updates directory:",F);const _=i||t;console.log(`Using client directory: ${_} (version: ${t})`);const w=L.isAbsolute(s)?s:L.resolve(process.cwd(),s),S=[];u.some(N=>N.includes("modlauncher")||N.includes("ModLauncher")||N.includes("bootstraplauncher"))&&g==="8"&&(console.warn("[Launch] ⚠️  WARNING: ModLauncher detected in classpath, but Java 8 is required. ModLauncher requires Java 16+. This may cause UnsupportedClassVersionError."),console.warn("[Launch] Consider using Java 16+ or check if the client uses the correct Forge version for Minecraft 1.12.2."));const c=u.includes("libraries");let p=L.join(F,_,"libraries");x.existsSync(p)||(p=L.join(F,t,"libraries"));for(const N of u)if(N==="client.jar"){let U=L.join(F,_,"client.jar");if(x.existsSync(U)||(U=L.join(w,_,"client.jar")),x.existsSync(U)||(U=L.join(F,t,"client.jar")),x.existsSync(U)||(U=L.join(w,t,"client.jar")),!x.existsSync(U))return{success:!1,error:`Client JAR not found. Searched in:
- ${L.join(F,_,"client.jar")}
- ${L.join(F,t,"client.jar")}
- ${L.join(w,_,"client.jar")}
- ${L.join(w,t,"client.jar")}

Please download Minecraft files first.`};S.push(U)}else if(N==="libraries"){let U=L.join(F,_,"libraries");x.existsSync(U)||(U=L.join(w,_,"libraries")),x.existsSync(U)||(U=L.join(F,t,"libraries")),x.existsSync(U)||(U=L.join(w,t,"libraries"));const H=_e(U);if(H.length===0)console.warn(`[Launch] ⚠️  No JAR files found in ${U}`);else{console.log(`[Launch] Found ${H.length} JAR files in libraries directory`);const Oe=H.find(ee=>ee.includes("fastutil")),Ue=H.find(ee=>ee.includes("launchwrapper")),Ae=H.find(ee=>ee.includes("forge"));Oe?console.log(`[Launch] ✓ Found fastutil: ${L.basename(Oe)}`):console.warn("[Launch] ⚠️  WARNING: fastutil JAR not found in libraries!"),Ue?console.log(`[Launch] ✓ Found launchwrapper: ${L.basename(Ue)}`):console.warn("[Launch] ⚠️  WARNING: launchwrapper JAR not found in libraries!"),Ae?console.log(`[Launch] ✓ Found forge: ${L.basename(Ae)}`):console.warn("[Launch] ⚠️  WARNING: forge JAR not found in libraries!")}S.push(...H);const Y=Se(U);Y.length>0&&console.log(`Found ${Y.length} native library directories`)}else{let U=L.isAbsolute(N)?N:L.join(F,_,N);x.existsSync(U)||(U=L.join(w,_,N)),x.existsSync(U)||(U=L.join(F,t,N)),x.existsSync(U)||(U=L.join(w,t,N)),x.existsSync(U)?S.push(U):(console.warn(`[Launch] ⚠️  ClassPath entry not found: ${U}`),console.warn("[Launch]   Searched in:"),console.warn(`[Launch]     - ${L.join(F,_,N)}`),console.warn(`[Launch]     - ${L.join(w,_,N)}`),console.warn(`[Launch]     - ${L.join(F,t,N)}`),console.warn(`[Launch]     - ${L.join(w,t,N)}`))}if(!c&&x.existsSync(p)){console.log('[Launch] ⚠️  classPath does not contain "libraries" entry, but libraries directory exists.'),console.log("[Launch] Adding all JAR files from libraries directory to ensure all dependencies are included...");const N=_e(p);if(N.length>0){console.log(`[Launch] Found ${N.length} additional JAR files in libraries directory`);for(const U of N)S.includes(U)||S.push(U)}}if(S.length===0)return{success:!1,error:"No valid classpath entries found. Please ensure Minecraft files are downloaded."};console.log(`[Launch] Resolved classpath (${S.length} entries):`);const f=S.find(N=>N.includes("client.jar")),h=S.find(N=>N.includes("fastutil")),y=S.find(N=>N.includes("launchwrapper")),T=S.find(N=>N.includes("forge"));if(console.log(`[Launch]   - client.jar: ${f||"NOT FOUND"}`),console.log(`[Launch]   - fastutil: ${h||"NOT FOUND"}`),console.log(`[Launch]   - launchwrapper: ${y||"NOT FOUND"}`),console.log(`[Launch]   - forge: ${T||"NOT FOUND"}`),console.log(`[Launch] Total JAR files in classpath: ${S.length}`),!h)return console.error("[Launch] ❌ ERROR: fastutil library not found in classpath!"),console.error("[Launch] This is required for Minecraft 1.12.2."),console.error("[Launch] Expected: libraries/it/unimi/dsi/fastutil/7.1.0/fastutil-7.1.0.jar"),console.error("[Launch] Full classpath:"),S.forEach((N,U)=>{const H=x.existsSync(N);console.error(`[Launch]   [${U+1}] ${H?"✓":"✗"} ${N}`)}),{success:!1,error:`FastUtil library not found in classpath. This is required for Minecraft 1.12.2.

Expected: libraries/it/unimi/dsi/fastutil/7.1.0/fastutil-7.1.0.jar

Please ensure all Minecraft libraries are downloaded. Check the libraries directory:
${L.join(F,_,"libraries")}`};if(console.log("[Launch] ✓ FastUtil library found in classpath"),l==="net.minecraft.launchwrapper.Launch"){if(!y)return console.error("[Launch] ❌ ERROR: launchwrapper library not found in classpath!"),console.error("[Launch] This is required for Forge 1.12.2."),console.error("[Launch] Expected: libraries/net/minecraft/launchwrapper/1.12/launchwrapper-1.12.jar"),console.error("[Launch] Full classpath:"),S.forEach((N,U)=>{const H=x.existsSync(N);console.error(`[Launch]   [${U+1}] ${H?"✓":"✗"} ${N}`)}),{success:!1,error:`LaunchWrapper library not found in classpath. This is required for Forge 1.12.2.

Expected: libraries/net/minecraft/launchwrapper/1.12/launchwrapper-1.12.jar

Please ensure all Minecraft libraries are downloaded. Check the libraries directory:
${L.join(F,_,"libraries")}`};console.log("[Launch] ✓ LaunchWrapper library found in classpath")}x.existsSync(w)||(console.log(`Creating working directory: ${w}`),x.mkdirSync(w,{recursive:!0})),x.existsSync(p)||(p=L.join(F,t,"libraries"));let O=[];if(x.existsSync(p))try{const N=await xt(p,_);O=Se(p)}catch(N){console.warn("Failed to extract native libraries:",N.message),O=Se(p)}console.log(`Searching for native libraries in: ${p}`),console.log(`Found ${O.length} native library directories:`),O.forEach(N=>console.log(`  - ${N}`));const P=[...a];if(O.length>0){const N=O.join(L.delimiter);P.push(`-Djava.library.path=${N}`),console.log(`Added native library path: ${N}`)}else console.warn("⚠️  No native libraries found! This may cause UnsatisfiedLinkError."),console.warn(`   Please re-download Minecraft files: npm run download-minecraft ${t}`);if(P.push("-cp",S.join(L.delimiter),l,...o),l==="net.minecraft.launchwrapper.Launch"){console.log("[Launch] Forge LaunchWrapper - Full command:"),console.log(`[Launch] Java: ${r}`),console.log(`[Launch] Main Class: ${l}`),console.log(`[Launch] ClassPath entries: ${S.length}`),console.log(`[Launch] ClassPath (first 5): ${S.slice(0,5).join(", ")}`);const N=S.some(H=>H.includes("launchwrapper")||H.includes("LaunchWrapper"));console.log(`[Launch] Has launchwrapper in classpath: ${N}`),N||(console.error("[Launch] ❌ ERROR: launchwrapper library not found in classpath!"),console.error("[Launch] This is required for Forge 1.12.2. Please ensure libraries are downloaded."),console.error("[Launch] Expected path: libraries/net/minecraft/launchwrapper/1.12/launchwrapper-1.12.jar"),console.error("[Launch] Full classpath:",S.join(`
`)));const U=S.some(H=>H.includes("forge")||H.includes("Forge"));console.log(`[Launch] Has Forge library in classpath: ${U}`),console.log(`[Launch] Game Args: ${o.join(" ")}`),console.log(`[Launch] Has --tweakClass in gameArgs: ${o.includes("--tweakClass")}`)}const C=Q(r);if(C&&console.log(`[Launch] Final Java check - Path: ${r}, Version: ${C.major} (${C.full})`),console.log("Launching Minecraft with:",{javaPath:r,workingDir:w,classPathCount:S.length,mainClass:l,jvmArgsCount:a.length,gameArgsCount:o.length,javaVersion:C?.major||"unknown"}),console.log("Full command:",`${r} ${P.join(" ")}`),r!=="java"&&!x.existsSync(r))return{success:!1,error:`Java executable not found: ${r}. Please check the Java path in settings.`};let j=null;try{const N=g||"8";if(j=ct(r,N),N==="8"){const U=Q(r);if(console.log(`[JavaCheck] Detected Java version: ${U?.major||"unknown"} (${U?.full||"unknown"})`),!U)return{success:!1,error:"Failed to detect Java version. Please ensure Java 8 is installed and the path is correct."};if(U.major!==8)return{success:!1,error:`Java version mismatch. Minecraft 1.12.2 with Forge requires Java 8 exactly, but Java ${U.major} (${U.full}) is being used. Please install Java 8 or specify the correct path to Java 8 in settings.`};console.log(`[JavaCheck] ✓ Java 8 confirmed: ${U.full}`)}if(!j.valid)return{success:!1,error:j.error||`Java version check failed. Required: Java ${N}+, found: ${j.currentVersion||"unknown"}`};console.log(`[JavaCheck] ✓ Java version check passed: ${j.currentVersion} (required: ${N}${N==="8"?" exactly":"+"})`)}catch(N){return{success:!1,error:`Failed to verify Java: ${N.message}. Please install Java or specify the full path to Java in settings.`}}let b=null,B=!1,$=null;const M=W.spawn(r,P,{cwd:w,stdio:"pipe",shell:!1});M.on("error",N=>{b=N,console.error("Process spawn error:",N),R?.webContents.send("game:error",`Process error: ${N.message}`)});let z="",K="";const G=[],ie=100,Re=[/connection.*refused/i,/connection.*timeout/i,/connection.*timed.*out/i,/authentication.*failed/i,/server.*full/i,/version.*mismatch/i,/network.*error/i,/can't.*connect/i,/unable.*to.*connect/i,/failed.*to.*connect/i];return M.stderr?.on("data",N=>{const U=N.toString();z+=U,console.error("Game stderr:",U),R?.webContents.send("game:error",U);for(const H of Re)if(H.test(U)){R?.webContents.send("game:connection-issue",{message:U,type:Ye(U)});break}}),M.stdout?.on("data",N=>{const U=N.toString();console.log("Game stdout:",U),R?.webContents.send("game:log",U);const H=U.split(`
`).filter(Y=>Y.trim());G.push(...H),G.length>ie&&G.splice(0,G.length-ie),K=G.join(`
`);for(const Y of Re)if(Y.test(U)){R?.webContents.send("game:connection-issue",{message:U,type:Ye(U)});break}}),M.on("exit",(N,U)=>{if(B=!0,$=N,console.log(`Game process exited with code ${N}, signal ${U}`),R?.webContents.send("game:exit",N??0),N!==0&&N!==null){const H=z||`Game exited with code ${N}`;console.error("Game failed:",H),R?.webContents.send("game:error",H),R?.webContents.send("game:crash",{exitCode:N,errorMessage:H.substring(0,5e3),stderrOutput:z.substring(0,1e4),stdoutOutput:K.substring(0,1e4),profileId:E,profileVersion:t,serverAddress:v,serverPort:m,javaVersion:j?.currentVersion,javaPath:r,os:process.platform,osVersion:Qe.release(),userId:I,username:D})}}),M.on("close",(N,U)=>{B||(console.log(`Game process closed with code ${N}, signal ${U}`),B=!0,$=N,R?.webContents.send("game:exit",N??0))}),await new Promise(N=>setTimeout(N,500)),b?{success:!1,error:`Failed to start Java process: ${b.message}`}:B&&$!==0?{success:!1,error:`Game process exited immediately with code ${$}. Check the error messages above.`}:M.pid?(console.log(`Game process started successfully with PID: ${M.pid}`),{success:!0,pid:M.pid}):{success:!1,error:"Failed to start game process (no PID). Check Java installation and arguments."}}catch(F){return{success:!1,error:F.message}}});A.ipcMain.handle("file:ensureDir",async(n,e)=>{try{return await J.mkdir(e,{recursive:!0}),{success:!0}}catch(r){return{success:!1,error:r.message}}});A.ipcMain.handle("file:writeFile",async(n,e,r)=>{try{const a=L.dirname(e);return await J.mkdir(a,{recursive:!0}),await J.writeFile(e,Buffer.from(r)),{success:!0}}catch(a){return{success:!1,error:a.message}}});A.ipcMain.handle("file:deleteFile",async(n,e)=>{try{return await J.unlink(e),{success:!0}}catch(r){return{success:!1,error:r.message}}});A.ipcMain.handle("file:calculateHash",async(n,e,r)=>{try{const a=await J.readFile(e);return xe.createHash(r).update(a).digest("hex")}catch(a){throw new Error(`Failed to calculate hash: ${a.message}`)}});A.ipcMain.handle("file:readFile",async(n,e)=>{try{return await J.readFile(e,"utf-8")}catch(r){throw new Error(`Failed to read file: ${r.message}`)}});A.ipcMain.handle("file:exists",async(n,e)=>{try{return await J.access(e),!0}catch{return!1}});A.ipcMain.handle("http:request",async(n,e)=>new Promise((r,a)=>{try{const l=new URL(e.url),u=l.protocol==="https:"?fe:ne,o={hostname:l.hostname,port:l.port||(l.protocol==="https:"?443:80),path:l.pathname+l.search,method:e.method||"GET",headers:{"User-Agent":"Modern-Launcher/1.0",Accept:"application/json",...e.headers},timeout:e.timeout||3e4};let s;e.data&&["POST","PUT","PATCH"].includes(o.method)&&(typeof e.data=="string"?s=e.data:(s=JSON.stringify(e.data),o.headers["Content-Type"]="application/json"),o.headers["Content-Length"]=Buffer.byteLength(s)),console.log("[HTTP Request]",{method:o.method,url:e.url,hostname:o.hostname,port:o.port,path:o.path});const t=u.request(o,i=>{let g="";i.on("data",E=>{g+=E}),i.on("end",()=>{console.log("[HTTP Response]",{url:e.url,statusCode:i.statusCode,statusMessage:i.statusMessage,headers:i.headers});let E=g;try{E=JSON.parse(g)}catch{}r({status:i.statusCode,statusText:i.statusMessage,headers:i.headers,data:E})})});t.on("error",i=>{console.error("[HTTP Error]",{url:e.url,error:i.message,code:i.code}),a({message:i.message,code:i.code})}),t.on("timeout",()=>{t.destroy(),a({message:"Request timeout",code:"ETIMEDOUT"})}),s&&t.write(s),t.end()}catch(l){console.error("[HTTP Request Error]",{url:e.url,error:l.message}),a({message:l.message,code:l.code})}}));A.ipcMain.on("file:download",async(n,e,r,a)=>{const l=`${e}-${r}`;try{const u=L.dirname(r);await J.mkdir(u,{recursive:!0});const o=e.startsWith("https:")?fe:ne,s={};a&&(s.headers={Authorization:`Bearer ${a}`});const t=o.get(e,s,i=>{if(i.statusCode!==200){q.delete(l),n.reply("file:download:error",`HTTP ${i.statusCode}`);return}const g=parseInt(i.headers["content-length"]||"0",10),E=x.createWriteStream(r,{highWaterMark:64*1024});let v=0;q.set(l,{request:t,writer:E,destPath:r});let m=0;const I=Math.max(g*.05,1024*1024);i.on("data",D=>{if(v+=D.length,v-m>=I||v===g){const F=g>0?v/g*100:0;n.reply("file:download:progress",F),m=v}}),i.on("end",()=>{E.end()}),i.on("error",D=>{q.delete(l),E.destroy(),x.unlink(r,()=>{}),n.reply("file:download:error",D.message)}),i.pipe(E),E.on("error",D=>{q.delete(l),i.destroy(),x.unlink(r,()=>{}),n.reply("file:download:error",D.message)}),E.on("finish",()=>{q.delete(l),n.reply("file:download:complete")})});t.on("error",i=>{q.delete(l),n.reply("file:download:error",i.message)})}catch(u){q.delete(l),n.reply("file:download:error",u.message)}});A.ipcMain.handle("app:version",async()=>{try{const n=A.app.getPath("userData"),e=L.join(n,"launcher-version.json");if(x.existsSync(e)){const r=await J.readFile(e,"utf-8"),a=JSON.parse(r);if(a.version)return console.log(`[LauncherUpdate] Using version from config file: ${a.version}`),a.version}}catch(n){console.warn("[LauncherUpdate] Failed to read version from config file:",n)}return A.app.getVersion()});A.ipcMain.handle("app:paths",()=>({userData:A.app.getPath("userData"),appData:A.app.getPath("appData"),temp:A.app.getPath("temp")}));A.ipcMain.handle("app:updatesDir",()=>at());A.ipcMain.handle("java:findInstallations",async()=>{try{return{success:!0,installations:Ft().map(r=>{const a=Q(r);return{path:r,version:a?.version||"unknown",major:a?.major||0,full:a?.full||""}})}}catch(n){return{success:!1,error:n.message,installations:[]}}});A.ipcMain.handle("java:checkVersion",async(n,e,r)=>{try{return{success:!0,...ct(e,r)}}catch(a){return{success:!1,valid:!1,error:a.message,requiredVersion:r}}});A.ipcMain.handle("java:getVersion",async(n,e)=>{try{const r=Q(e);return r?{success:!0,...r}:{success:!1,error:"Failed to get Java version"}}catch(r){return{success:!1,error:r.message}}});A.ipcMain.handle("dialog:selectJavaFile",async()=>{try{const n=process.platform==="win32",e=await A.dialog.showOpenDialog(R,{title:"Select Java Executable",filters:[{name:"Java Executable",extensions:n?["exe"]:[]},{name:"All Files",extensions:["*"]}],properties:["openFile"]});if(e.canceled||e.filePaths.length===0)return{success:!1,canceled:!0};const r=e.filePaths[0],a=Q(r);return a?{success:!0,path:r,version:a.version,major:a.major}:{success:!1,error:"Selected file is not a valid Java executable"}}catch(n){return{success:!1,error:n.message}}});A.ipcMain.handle("notification:show",async(n,e,r,a)=>{try{if(!A.Notification.isSupported())return console.warn("Desktop notifications are not supported on this system"),{success:!1,error:"Notifications not supported"};const l=new A.Notification({title:e,body:r,icon:a?.icon,silent:!a?.sound});return l.on("click",()=>{R&&(R.isMinimized()&&R.restore(),R.focus())}),l.show(),setTimeout(()=>{l.close()},5e3),{success:!0}}catch(l){return console.error("Error showing notification:",l),{success:!1,error:l.message}}});let ce=0,le=null;A.ipcMain.handle("launcher:checkUpdate",async(n,e,r,a)=>{try{const l=`${r}/api/launcher/check-update?currentVersion=${encodeURIComponent(e)}`;return console.log(`[LauncherUpdate] Checking for updates: ${l}`),console.log(`[LauncherUpdate] Current version: ${e}`),new Promise(u=>{const o=l.startsWith("https:")?fe:ne,s={"User-Agent":"Modern-Launcher/1.0"};a&&(s.Authorization=`Bearer ${a}`);const t=o.get(l,{headers:s},i=>{let g="";console.log(`[LauncherUpdate] Response status: ${i.statusCode}`),i.on("data",E=>{g+=E}),i.on("end",()=>{try{console.log(`[LauncherUpdate] Response data: ${g.substring(0,200)}...`);const E=JSON.parse(g);E.success&&E.data?E.data.hasUpdate?(console.log(`[LauncherUpdate] Update found! Version: ${E.data.latestVersion?.version}`),u({success:!0,hasUpdate:!0,updateInfo:E.data.latestVersion,isRequired:E.data.isRequired})):(console.log("[LauncherUpdate] No updates available"),u({success:!0,hasUpdate:!1})):(console.error("[LauncherUpdate] Invalid response:",E),u({success:!1,error:"Invalid response from server"}))}catch(E){console.error("[LauncherUpdate] Parse error:",E),u({success:!1,error:`Failed to parse response: ${E.message}`})}})});t.on("error",i=>{console.error("[LauncherUpdate] Network error:",i),u({success:!1,error:`Network error: ${i.message}`})}),t.setTimeout(1e4,()=>{console.error("[LauncherUpdate] Request timeout"),t.destroy(),u({success:!1,error:"Request timeout"})})})}catch(l){return console.error("[LauncherUpdate] Error:",l),{success:!1,error:l.message}}});A.ipcMain.on("launcher:downloadUpdate",async(n,e,r)=>{try{const a=e.downloadUrl;if(!a){n.reply("launcher:update:error","Download URL is not provided");return}const l=process.platform==="win32",u=A.app.getPath("temp"),o=l?`launcher-update-${e.version}.exe`:`launcher-update-${e.version}.${process.platform==="darwin"?"dmg":"AppImage"}`,s=L.join(u,o),t=`${a}-${Date.now()}`;le=t,ce=0,await J.mkdir(L.dirname(s),{recursive:!0});const i=(g,E=5)=>{if(E<=0){n.reply("launcher:update:error","Too many redirects");return}const m=(g.startsWith("https:")?fe:ne).get(g,I=>{if(I.statusCode===301||I.statusCode===302||I.statusCode===307||I.statusCode===308){const w=I.headers.location;if(!w){n.reply("launcher:update:error",`HTTP ${I.statusCode}: No redirect location`);return}const S=w.startsWith("http")?w:new URL(w,g).href;console.log(`[LauncherUpdate] Following redirect to: ${S}`),i(S,E-1);return}if(I.statusCode!==200){n.reply("launcher:update:error",`HTTP ${I.statusCode}`);return}const D=parseInt(I.headers["content-length"]||"0",10),F=x.createWriteStream(s);let _=0;I.on("data",w=>{if(le!==t){I.destroy(),F.destroy();return}_+=w.length,ce=D>0?_/D*100:0,n.reply("launcher:update:progress",ce)}),I.on("end",async()=>{if(le!==t){try{await J.unlink(s)}catch{}return}if(F.end(),e.fileHash)try{const w=await J.readFile(s);if(xe.createHash("sha256").update(w).digest("hex").toLowerCase()!==e.fileHash.toLowerCase()){await J.unlink(s),n.reply("launcher:update:error","File hash verification failed. File may be corrupted.");return}}catch(w){await J.unlink(s),n.reply("launcher:update:error",`Hash verification error: ${w.message}`);return}n.reply("launcher:update:complete",s)}),I.on("error",async w=>{F.destroy();try{await J.unlink(s)}catch{}n.reply("launcher:update:error",w.message)}),I.pipe(F),F.on("error",async w=>{I.destroy();try{await J.unlink(s)}catch{}n.reply("launcher:update:error",w.message)})});m.on("error",I=>{n.reply("launcher:update:error",I.message)}),m.setTimeout(3e5,()=>{m.destroy(),n.reply("launcher:update:error","Download timeout")})};i(a)}catch(a){n.reply("launcher:update:error",a.message)}});A.ipcMain.on("launcher:cancelUpdate",()=>{le=null,ce=0});A.ipcMain.handle("launcher:installUpdate",async(n,e,r)=>{try{if(!x.existsSync(e))return{success:!1,error:"Installer file not found"};const a=A.app.getPath("userData"),l=L.join(a,"launcher-version.json");try{await J.writeFile(l,JSON.stringify({version:r,updatedAt:new Date().toISOString()}),"utf-8"),console.log(`[LauncherUpdate] Saved version ${r} to config file`)}catch(t){console.warn("[LauncherUpdate] Failed to save version to config file:",t)}const u=process.platform==="win32",o=process.platform==="darwin",s=process.execPath;return u?(W.exec(`"${e}" /S /D="${L.dirname(s)}"`,t=>{t?console.error("Error running installer:",t):setTimeout(()=>{A.app.quit()},1e3)}),{success:!0}):o?(W.exec(`open "${e}"`,t=>{t&&console.error("Error opening DMG:",t)}),{success:!0,message:"Please follow the installation instructions"}):(await J.chmod(e,493),W.exec(`"${e}"`,t=>{t?console.error("Error running installer:",t):setTimeout(()=>{A.app.quit()},1e3)}),{success:!0})}catch(a){return{success:!1,error:a.message}}});A.ipcMain.on("launcher:restart",()=>{A.app.relaunch(),A.app.exit(0)});
